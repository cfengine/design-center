body common control
{
      bundlesequence => { "g", "cfsketch_run" };
      inputs => { $inputs };
}

bundle common g
{
  classes:
[% FOREACH activation IN activations.keys.sort %]

 [% FOREACH var IN activations.$activation.contexts.keys.sort %]
      "_${activation}_$var" expression => "[% UNLESS activations.$activation.contexts.$var.value %]![% END %]any";
 [% END %]

[% END %]
  vars:
[% FOREACH activation IN activations.keys.nsort %]

 [% FOREACH var IN activations.$activation.vars.keys.sort %]
      "_${activation}_$var" [% activations.$activation.vars.$var.type %] => [% activations.$activation.vars.$var.value %];
 [% END %]

[% END %]
}

bundle agent cfsketch_run
{
  methods:
[% FOREACH activation IN activations.keys.sort %]
    _${activation}_${activations.$activation.prefix}__activated::
      "$activation ${activations.$activation.sketch} ${activations.$activation.params}" usebundle => ${activations.$activation.entry_bundle}("g._${activation}_${activations.$activation.prefix}__");
[% END %]
}
