body common control {

    bundlesequence => { "main",};

    inputs => { "cfengine_stdlib.cf", 
                "sketches/nagios_plugin_agent/main.cf" };
}

bundle agent main {
vars:
    "check[check_dummy][args]" string => "0 Test ok";

    "check[check_dummy_OK][plugin_name]" string => "check_dummy";
    "check[check_dummy_OK][args]" string => "0 Test ok";
    "check[check_dummy_OK][_usebundle_if_ok]" string => "bundleifok";


    #  cf-agent -D superdupermop -KIf ./test.cf
    # this reports even when not run but it shouldnt
    # Maybe I am doing something wrong, maybe isvariable doesn't work with module set variables
    "check[check_dummy_DONTRUN][plugin_name]" string => "check_dummy";
    "check[check_dummy_DONTRUN][args]" string => "0 Test ok";
    "check[check_dummy_DONTRUN][_usebundle_if_ok]" string => "bundleifok";
    "check[check_dummy_DONTRUN][_execution_context]" string => "superdupermop";


    "check[check_dummy_WARN][plugin_name]" string => "check_dummy";
    "check[check_dummy_WARN][args]" string => "1 Test warn";
    "check[check_dummy_WARN][_usebundle_if_warning]" string => "bundleifwarn";

    "check[check_dummy_CRIT][plugin_name]" string => "check_dummy";
    "check[check_dummy_CRIT][args]" string => "2 Test critical";
    "check[check_dummy_CRIT][_usebundle_if_critical]" string => "bundleifcritical";

    "check[check_dummy_UNKNOWN][plugin_name]" string => "check_dummy";
    "check[check_dummy_UNKNOWN][args]" string => "3 Test unknown";
    "check[check_dummy_UNKNOWN][_usebundle_if_critical]" string => "bundleifunknown";

    "check[check_dummy_PROTOERROR][plugin_name]" string => "check_dummy";
    "check[check_dummy_PROTOERROR][args]" string => "4 Test protocal error";
    "check[check_dummy_PROTOERROR][_usebundle_if_protocol_error]" string => "bundleifprotoerror";

methods:
    "any" usebundle => nagios_plugin_agent("main.check");
}

bundle agent bundleifok{
reports:
    cfengine::
        "THE CHECK WAS OK THIS IS FROM THE CALLED BUNDLE";
}


bundle agent bundleifwarn{
reports:
    cfengine::
        "THE CHECK WAS in WARNING  THIS IS FROM THE CALLED BUNDLE";
}

bundle agent bundleifcritical{
reports:
    cfengine::
        "THE CHECK WAS in CRITICAL  THIS IS FROM THE CALLED BUNDLE";
}

bundle agent bundleifunknown{
reports:
    cfengine::
        "THE CHECK WAS in UNKNOWN  THIS IS FROM THE CALLED BUNDLE";
}

bundle agent bundleifprotoerror{
reports:
    cfengine::
        "THE CHECK WAS in PROTOCAL ERROR  THIS IS FROM THE CALLED BUNDLE";
}

